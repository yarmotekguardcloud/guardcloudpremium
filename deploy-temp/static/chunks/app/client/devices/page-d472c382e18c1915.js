(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2364],{63:(e,t,r)=>{"use strict";var a=r(7260);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},984:(e,t,r)=>{Promise.resolve().then(r.bind(r,4392))},1150:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let a=r(5155),n=r(2115),l=r(4437);function s(e){return{default:e&&"default"in e?e.default:e}}r(6552);let i={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},c=function(e){let t={...i,...e},r=(0,n.lazy)(()=>t.loader().then(s)),c=t.loading;function d(e){let s=c?(0,a.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?n.Suspense:n.Fragment,o=t.ssr?(0,a.jsxs)(a.Fragment,{children:[null,(0,a.jsx)(r,{...e})]}):(0,a.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(r,{...e})});return(0,a.jsx)(d,{...i?{fallback:s}:{},children:o})}return d.displayName="LoadableComponent",d}},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{bindSnapshot:function(){return s},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return i}});let r=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class a{disable(){throw r}getStore(){}run(){throw r}exit(){throw r}enterWith(){throw r}static bind(e){return e}}let n="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return n?new n:new a}function s(e){return n?n.bind(e):a.bind(e)}function i(){return n?n.snapshot():function(e,...t){return e(...t)}}},4392:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a,n=r(5155),l=r(2115),s=r(63),i=r(7909);let c=null!=(a=r(5704).env.NEXT_PUBLIC_API_BASE_URL)?a:"https://yarmotek-guardcloud-api.myarbanga.workers.dev",d="gc_client_id",o=(0,i.default)(()=>r.e(7123).then(r.bind(r,7123)),{loadableGenerated:{webpack:()=>[7123]},ssr:!1});function u(e){if(!e.lastHeartbeat)return!1;let t=new Date(e.lastHeartbeat).getTime();return!Number.isNaN(t)&&Date.now()-t<=3e5}function x(){let e=(0,s.useRouter)(),[t,r]=(0,l.useState)(null),[a,i]=(0,l.useState)([]),[x,b]=(0,l.useState)(!0),[p,j]=(0,l.useState)(null),[y,v]=(0,l.useState)("ALL"),[N,w]=(0,l.useState)(!1),[P,S]=(0,l.useState)(null);(0,l.useEffect)(()=>{let t=window.localStorage.getItem(d);t?r(t):e.replace("/client/login")},[e]),(0,l.useEffect)(()=>{if(!t)return;let e=!1,r=t.toLowerCase();async function a(){try{var t,a;j(null),b(!0);let n=await fetch("".concat(c,"/devices"));if(!n.ok){let e=await n.text();throw Error("HTTP ".concat(n.status," ").concat(n.statusText," – ").concat(e))}let l=await n.json(),s=(null!=(a=null!=(t=l.devices)?t:l.items)?a:[]).map(e=>{var t,r,a,n,l,s;return{deviceId:String(null!=(t=e.deviceId)?t:""),hardwareId:e.hardwareId?String(e.hardwareId):void 0,type:String(null!=(r=e.type)?r:"UNKNOWN"),category:String(null!=(a=e.category)?a:"UNKNOWN"),name:e.name?String(e.name):String(null!=(n=e.deviceId)?n:"UNKNOWN"),clientId:e.clientId?String(e.clientId):void 0,clientName:e.clientName?String(e.clientName):void 0,lat:Number(null!=(l=e.lat)?l:0),lng:Number(null!=(s=e.lng)?s:0),battery:"number"==typeof e.battery?e.battery:null!=e.battery?Number(e.battery):null,charging:"boolean"==typeof e.charging?e.charging:null!=e.charging?!!e.charging:null,lastHeartbeat:e.lastHeartbeat?String(e.lastHeartbeat):void 0}}).filter(e=>{var t,a;let n=(null!=(t=e.clientId)?t:"").toLowerCase(),l=(null!=(a=e.clientName)?a:"").toLowerCase();return n===r||l===r||n.endsWith(r)||r.endsWith(n)||l.includes(r)});e||(i(s),S(new Date),b(!1))}catch(r){let t=r instanceof Error?r.message:"erreur inconnue";e||(j("Impossible de r\xe9cup\xe9rer vos appareils (".concat(t,").")),b(!1))}}a();let n=setInterval(a,3e4);return()=>{e=!0,clearInterval(n)}},[t]);let C=(0,l.useMemo)(()=>{let e=a.length,t=a.filter(e=>"PHONE"===e.category).length;return{total:e,phones:t,pcs:a.filter(e=>"PC"===e.category).length,active:a.filter(e=>u(e)).length}},[a]),_=(0,l.useMemo)(()=>a.filter(e=>("PHONE"!==y||"PHONE"===e.category)&&("PC"!==y||"PC"===e.category)&&(!N||!!u(e))),[a,y,N]),O=_.length,E=P?P.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"---",I=null!=t?t:"Client";return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[(0,n.jsxs)("nav",{className:"bg-[#05060f] text-white h-14 flex items-center justify-between px-6",children:[(0,n.jsx)("div",{className:"font-semibold text-lg",children:"Yarmotek GuardCloud – Espace Client"}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("span",{className:"text-xs opacity-70",children:["ID : ",I]}),(0,n.jsx)("button",{onClick:function(){window.localStorage.removeItem(d),e.push("/client/login")},className:"bg-red-600 hover:bg-red-700 text-xs font-medium px-4 py-1.5 rounded-lg",children:"D\xe9connexion"})]})]}),(0,n.jsx)("main",{className:"flex-1 flex flex-col px-6 py-4",children:(0,n.jsxs)("div",{className:"max-w-6xl w-full mx-auto",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Mes appareils GuardCloud"}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Vue temps r\xe9el de vos appareils (PC & smartphones) li\xe9s \xe0 votre compte."}),(0,n.jsxs)("p",{className:"text-[11px] text-gray-400 mt-1",children:["Dernier rafra\xeechissement\xa0: ",E]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-5",children:[(0,n.jsx)(m,{label:"Appareils suivis",value:C.total}),(0,n.jsx)(m,{label:"Smartphones",value:C.phones}),(0,n.jsx)(m,{label:"PC",value:C.pcs}),(0,n.jsx)(m,{label:"Actifs (< 5 min)",value:C.active})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-5",children:[(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow border border-gray-200 p-4",children:[(0,n.jsx)("h2",{className:"text-sm font-semibold mb-3",children:"Filtres"}),(0,n.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,n.jsx)(h,{label:"Tous",active:"ALL"===y,onClick:()=>v("ALL")}),(0,n.jsx)(h,{label:"Phones",active:"PHONE"===y,onClick:()=>v("PHONE")}),(0,n.jsx)(h,{label:"PC",active:"PC"===y,onClick:()=>v("PC")})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2 text-xs mt-1",children:[(0,n.jsx)("input",{type:"checkbox",checked:N,onChange:e=>w(e.target.checked),className:"rounded"}),"Afficher uniquement les appareils actifs (< 5 min)"]}),(0,n.jsxs)("p",{className:"mt-3 text-[11px] text-gray-400",children:[O," appareil(s) affich\xe9(s)."]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow border border-gray-200 p-4 flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("h2",{className:"text-sm font-semibold",children:"Carte temps r\xe9el – Mes appareils"}),(0,n.jsx)("span",{className:"text-[11px] text-gray-400",children:"Fond OSM / Satellite"})]}),(0,n.jsx)("div",{className:"flex-1 min-h-[260px] rounded-xl overflow-hidden border border-gray-100",children:(0,n.jsx)(o,{devices:_})})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow border border-gray-200 p-4 mb-6",children:[(0,n.jsxs)("h2",{className:"text-sm font-semibold mb-3",children:["D\xe9tail de mes appareils (",O,")"]}),x?(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"Chargement de vos appareils…"}):p?(0,n.jsxs)("div",{className:"text-xs text-red-600",children:["Erreur : ",p]}):0===_.length?(0,n.jsx)("div",{className:"text-xs text-gray-500",children:"Aucun appareil enregistr\xe9 pour ce compte."}):(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full text-xs border-collapse",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-50 text-gray-600",children:[(0,n.jsx)(g,{children:"APPAREIL"}),(0,n.jsx)(g,{children:"DEVICE ID"}),(0,n.jsx)(g,{children:"CAT\xc9GORIE"}),(0,n.jsx)(g,{children:"COORDONN\xc9ES"}),(0,n.jsx)(g,{children:"BATTERIE"}),(0,n.jsx)(g,{children:"ACTIF"}),(0,n.jsx)(g,{children:"DERNIER HEARTBEAT"})]})}),(0,n.jsx)("tbody",{children:_.map(e=>(0,n.jsxs)("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[(0,n.jsx)(f,{children:(0,n.jsx)("div",{className:"font-medium text-[11px]",children:e.name})}),(0,n.jsxs)(f,{children:[(0,n.jsx)("div",{className:"font-mono text-[11px]",children:e.deviceId}),e.hardwareId&&(0,n.jsx)("div",{className:"text-[10px] text-gray-400",children:e.hardwareId})]}),(0,n.jsx)(f,{children:e.category||"-"}),(0,n.jsx)(f,{children:e.lat||e.lng?"".concat(e.lat.toFixed(6),", ").concat(e.lng.toFixed(6)):"-"}),(0,n.jsx)(f,{children:"number"==typeof e.battery?(0,n.jsxs)(n.Fragment,{children:[e.battery,"%"," ",(0,n.jsx)("span",{className:"text-[10px] text-gray-500",children:!0===e.charging?"(En charge)":!1===e.charging?"(Sur batterie)":""})]}):"-"}),(0,n.jsx)(f,{children:(0,n.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[10px] ".concat(u(e)?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"),children:u(e)?"Actif":"Inactif"})}),(0,n.jsx)(f,{children:e.lastHeartbeat?new Date(e.lastHeartbeat).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"})]},e.deviceId))})]})})]})]})})]})}function m(e){let{label:t,value:r}=e;return(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow border border-gray-200 px-4 py-3 flex flex-col justify-between",children:[(0,n.jsx)("div",{className:"text-[11px] text-gray-500 mb-1",children:t}),(0,n.jsx)("div",{className:"text-xl font-semibold",children:r})]})}function h(e){let{label:t,active:r,onClick:a}=e;return(0,n.jsx)("button",{type:"button",onClick:a,className:"px-3 py-1.5 rounded-full text-xs border ".concat(r?"bg-blue-600 text-white border-blue-600 shadow-sm":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),children:t})}function g(e){let{children:t}=e;return(0,n.jsx)("th",{className:"text-left font-medium px-3 py-2 border-b border-gray-100",children:t})}function f(e){let{children:t}=e;return(0,n.jsx)("td",{className:"px-3 py-2 align-top",children:t})}},4437:(e,t,r)=>{"use strict";function a(e){let{reason:t,children:r}=e;return r}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}}),r(4553)},6278:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let a=r(8140)._(r(1150));function n(e,t){var r;let n={};"function"==typeof e&&(n.loader=e);let l={...n,...t};return(0,a.default)({...l,modules:null==(r=l.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6552:(e,t,r)=>{"use strict";function a(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return a}}),r(5155),r(7650),r(8567),r(7278)},7828:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return a}});let a=(0,r(4054).createAsyncLocalStorage)()},7909:(e,t,r)=>{"use strict";r.d(t,{default:()=>n.a});var a=r(6278),n=r.n(a)},8567:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return a.workAsyncStorageInstance}});let a=r(7828)}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=984)),_N_E=e.O()}]);