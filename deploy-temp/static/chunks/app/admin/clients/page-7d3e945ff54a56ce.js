(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7097],{1284:(e,t,l)=>{Promise.resolve().then(l.bind(l,7425))},7425:(e,t,l)=>{"use strict";l.d(t,{default:()=>o});var s=l(5155),r=l(2115);let a="gc_clients_prefs_v1";function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"—";return"string"==typeof e&&e.trim().length?e.trim():t}function i(e){var t,l,s,r,a,i;let d=String(null!=(s=null!=(l=null!=(t=e.clientId)?t:e.id)?l:e.email)?s:"").trim()||"UNKNOWN",c=n(null!=(i=null!=(a=null!=(r=e.name)?r:e.contactName)?a:e.email)?i:d,"Client"),o="number"==typeof e.devicesCount?e.devicesCount:Array.isArray(e.devices)?e.devices.length:0,x="number"==typeof e.devicesOnline?e.devicesOnline:Array.isArray(e.devices)?e.devices.filter(e=>null==e?void 0:e.online).length:0,u="number"==typeof e.devicesOffline?e.devicesOffline:Math.max(o-x,0);return{clientId:d,name:c,contactName:n(e.contactName,"—"),phone:n(e.phone,"—"),email:n(e.email,"—"),status:n(e.status,"ACTIVE"),credits:function(e){if("number"==typeof e&&!Number.isNaN(e))return e;if("string"==typeof e){let t=parseFloat(e);return Number.isNaN(t)?null:t}return null}(e.credits),devicesCount:o,devicesOnline:x,devicesOffline:u,createdAt:"string"==typeof e.createdAt?e.createdAt:null,updatedAt:"string"==typeof e.updatedAt?e.updatedAt:null}}function d(e){let t=e.toUpperCase();return t.includes("SUSP")?"border-rose-500/60 bg-rose-500/10 text-rose-200":t.includes("PEND")?"border-amber-400/60 bg-amber-500/10 text-amber-200":t.includes("ACTIVE")?"border-emerald-500/60 bg-emerald-500/10 text-emerald-200":"border-slate-600 bg-slate-800/40 text-slate-200"}function c(e){if(!e)return"—";let t=Date.parse(e);return Number.isNaN(t)?"—":new Date(t).toLocaleString()}function o(){let[e,t]=(0,r.useState)([]),[l,n]=(0,r.useState)(!1),[o,u]=(0,r.useState)(null),[m,p]=(0,r.useState)({q:"",autoRefresh:!0,refreshSec:30,showOnlyActive:!1}),[h,b]=(0,r.useState)(null),f=(0,r.useRef)(!0),v=async()=>{var e,l,s;try{n(!0),u(null);let s=await fetch("/api/admin/clients",{method:"GET",cache:"no-store"}),r=await s.json();if(!s.ok||!r.ok)throw Error(null!=(e=r.error)?e:"API /admin/clients ok=false (HTTP ".concat(s.status,")"));let a=(null!=(l=r.items)?l:[]).map(i);if(!f.current)return;t(a),b(e=>e&&a.some(t=>t.clientId===e)?e:a.length?a[0].clientId:null)}catch(e){if(!f.current)return;console.error("Erreur chargement clients:",e),u(null!=(s=null==e?void 0:e.message)?s:"Erreur inconnue lors du chargement des clients"),t([]),b(null)}finally{if(!f.current)return;n(!1)}};(0,r.useEffect)(()=>{f.current=!0;try{{let e=window.localStorage.getItem(a);if(e){let t=JSON.parse(e);p(e=>({q:"string"==typeof t.q?t.q:e.q,autoRefresh:"boolean"==typeof t.autoRefresh?t.autoRefresh:e.autoRefresh,refreshSec:"number"==typeof t.refreshSec&&t.refreshSec>=15&&t.refreshSec<=120?t.refreshSec:e.refreshSec,showOnlyActive:"boolean"==typeof t.showOnlyActive?t.showOnlyActive:e.showOnlyActive}))}}}catch(e){}return v(),()=>{f.current=!1}},[]),(0,r.useEffect)(()=>{try{window.localStorage.setItem(a,JSON.stringify(m))}catch(e){}},[m]),(0,r.useEffect)(()=>{let e;if(m.autoRefresh)return e=window.setInterval(()=>{v()},1e3*Math.max(15,Math.min(120,m.refreshSec))),()=>{e&&window.clearInterval(e)}},[m.autoRefresh,m.refreshSec]);let{totalClients:g,totalDevices:N,totalOnline:j}=(0,r.useMemo)(()=>{let t=0,l=0;for(let s of e)t+=s.devicesCount,l+=s.devicesOnline;return{totalClients:e.length,totalDevices:t,totalOnline:l}},[e]),y=(0,r.useMemo)(()=>{let t=m.q.trim().toLowerCase(),l=m.showOnlyActive;return e.filter(e=>(!l||!!e.status.toUpperCase().includes("ACTIVE"))&&(!t||[e.clientId,e.name,e.contactName,e.phone,e.email,e.status].filter(Boolean).join(" ").toLowerCase().includes(t)))},[e,m.q,m.showOnlyActive]),w=(0,r.useMemo)(()=>{var t,l;return null!=(l=null!=(t=y.find(e=>e.clientId===h))?t:e.find(e=>e.clientId===h))?l:null},[y,e,h]),C=async e=>{try{if("undefined"==typeof navigator||!navigator.clipboard)return;await navigator.clipboard.writeText(e)}catch(e){}};return(0,s.jsxs)("div",{className:"flex min-h-[calc(100vh-3.5rem)] flex-col bg-slate-950 text-slate-100",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-slate-800 bg-gradient-to-r from-slate-950 via-slate-900 to-slate-950",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-sm font-semibold tracking-tight",children:["Clients • ",(0,s.jsx)("span",{className:"text-emerald-400",children:"Gestion"})]}),(0,s.jsxs)("div",{className:"text-[11px] text-slate-400",children:[g," client(s) • ",N," appareils •"," ",(0,s.jsxs)("span",{className:"text-emerald-300",children:[j," en ligne"]}),l&&(0,s.jsx)("span",{className:"ml-2 text-amber-300",children:"• Chargement…"}),o&&(0,s.jsx)("span",{className:"ml-2 text-rose-300",children:"• Erreur API"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,s.jsx)("button",{type:"button",onClick:()=>void v(),className:"rounded-full border border-emerald-500/60 bg-emerald-500/10 px-3 py-1 text-emerald-100 hover:bg-emerald-500/20",children:"Rafra\xeechir"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 rounded-full border border-slate-800 bg-slate-900/70 px-3 py-1",children:[(0,s.jsx)("span",{className:"text-[11px] text-slate-400",children:"Auto"}),(0,s.jsx)("button",{type:"button",onClick:()=>p(e=>({...e,autoRefresh:!e.autoRefresh})),className:"rounded-full px-2 py-0.5 text-[11px] ".concat(m.autoRefresh?"bg-emerald-500/15 text-emerald-200":"bg-slate-800 text-slate-300"),children:m.autoRefresh?"ON":"OFF"}),(0,s.jsx)("select",{value:m.refreshSec,onChange:e=>p(t=>({...t,refreshSec:Number(e.target.value)})),className:"rounded-full bg-slate-900 px-2 py-0.5 text-[11px] text-slate-100 border border-slate-800",children:[15,30,60,120].map(e=>(0,s.jsxs)("option",{value:e,children:[e,"s"]},e))})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 rounded-full border border-slate-800 bg-slate-900/70 px-3 py-1 text-[11px]",children:[(0,s.jsx)("input",{type:"checkbox",checked:m.showOnlyActive,onChange:e=>p(t=>({...t,showOnlyActive:e.target.checked}))}),"Actifs seulement"]})]})]}),(0,s.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[(0,s.jsx)("input",{value:m.q,onChange:e=>p(t=>({...t,q:e.target.value})),placeholder:"Rechercher (nom, email, t\xe9l\xe9phone, ID, statut)…",className:"w-full max-w-xl rounded-full border border-slate-800 bg-slate-900/70 px-4 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:border-emerald-400 focus:outline-none"}),m.q.trim().length>0&&(0,s.jsx)("button",{type:"button",onClick:()=>p(e=>({...e,q:""})),className:"rounded-full border border-slate-800 bg-slate-900/70 px-3 py-2 text-[11px] text-slate-300 hover:border-emerald-400",children:"R\xe9initialiser"}),(0,s.jsxs)("div",{className:"text-[11px] text-slate-500",children:[y.length," r\xe9sultat(s)"]})]})]}),(0,s.jsxs)("div",{className:"flex min-h-0 flex-1 gap-4 p-4",children:[(0,s.jsxs)("div",{className:"w-[360px] min-w-[320px] max-w-[420px] rounded-2xl border border-slate-800 bg-slate-950/60 p-3 shadow-[0_18px_40px_rgba(0,0,0,0.55)]",children:[o&&(0,s.jsx)("div",{className:"mb-3 rounded-xl border border-rose-500/40 bg-rose-500/10 p-3 text-[11px] text-rose-200",children:"Impossible de charger la liste des clients. V\xe9rifie le Worker /api/admin/clients."}),!o&&!l&&0===y.length&&(0,s.jsx)("div",{className:"rounded-xl bg-slate-900/60 p-3 text-sm text-slate-400",children:"Aucun client ne correspond au filtre."}),(0,s.jsx)("div",{className:"max-h-[calc(100vh-210px)] overflow-y-auto pr-1",children:y.map(e=>{let t=e.clientId===h;return(0,s.jsxs)("button",{type:"button",onClick:()=>b(e.clientId),className:"mb-2 w-full rounded-xl border px-3 py-2 text-left transition ".concat(t?"border-emerald-400 bg-gradient-to-r from-emerald-500/15 via-emerald-500/5 to-slate-900":"border-slate-800 bg-slate-900/50 hover:border-emerald-500/50 hover:bg-slate-900/70"),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"truncate text-sm font-semibold text-slate-100",children:e.name}),(0,s.jsx)("div",{className:"truncate text-[11px] text-slate-400",children:"—"!==e.email?e.email:e.clientId})]}),(0,s.jsx)("span",{className:"shrink-0 rounded-full border px-2 py-0.5 text-[10px] ".concat(d(e.status)),children:e.status})]}),(0,s.jsxs)("div",{className:"mt-2 flex items-center justify-between text-[11px] text-slate-400",children:[(0,s.jsxs)("span",{children:["Devices: ",e.devicesCount]}),(0,s.jsxs)("span",{className:"text-emerald-300",children:["Online: ",e.devicesOnline]})]})]},e.clientId)})})]}),(0,s.jsx)("div",{className:"flex min-h-0 flex-1 flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-950/60 p-4 shadow-[0_18px_40px_rgba(0,0,0,0.55)]",children:w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Dossier client"}),(0,s.jsx)("div",{className:"truncate text-lg font-semibold",children:w.name}),(0,s.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-[11px] text-slate-400",children:[(0,s.jsxs)("span",{className:"rounded-full border border-slate-800 bg-slate-900/70 px-2 py-0.5",children:["ID: ",(0,s.jsx)("span",{className:"text-slate-200",children:w.clientId})]}),(0,s.jsx)("span",{className:"rounded-full border px-2 py-0.5 ".concat(d(w.status)),children:w.status}),(0,s.jsx)("button",{type:"button",onClick:()=>void C(w.clientId),className:"rounded-full border border-slate-800 bg-slate-900/70 px-2 py-0.5 text-[11px] text-slate-200 hover:border-emerald-400",children:"Copier ID"})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("button",{type:"button",onClick:()=>void v(),className:"rounded-full border border-slate-800 bg-slate-900/70 px-3 py-1 text-[11px] text-slate-200 hover:border-emerald-400",children:"Recharger"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)(x,{label:"Contact",value:w.contactName}),(0,s.jsx)(x,{label:"T\xe9l\xe9phone",value:w.phone}),(0,s.jsx)(x,{label:"Email",value:w.email}),(0,s.jsx)(x,{label:"Cr\xe9dits",value:null==w.credits?"—":String(w.credits)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,s.jsx)(x,{label:"Appareils",value:String(w.devicesCount)}),(0,s.jsx)(x,{label:"En ligne",value:String(w.devicesOnline),accent:"emerald"}),(0,s.jsx)(x,{label:"Hors ligne",value:String(w.devicesOffline)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsx)(x,{label:"Cr\xe9\xe9",value:c(w.createdAt)}),(0,s.jsx)(x,{label:"Mis \xe0 jour",value:c(w.updatedAt)})]}),(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-800 bg-slate-950/80 p-3",children:[(0,s.jsx)("div",{className:"mb-2 text-[11px] uppercase tracking-wide text-slate-500",children:"Actions rapides"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>void C("—"!==w.email?w.email:w.clientId),className:"rounded-full border border-slate-800 bg-slate-900/70 px-3 py-1 text-[11px] text-slate-200 hover:border-emerald-400",children:"Copier email"}),(0,s.jsx)("button",{type:"button",onClick:()=>void C("—"!==w.phone?w.phone:w.clientId),className:"rounded-full border border-slate-800 bg-slate-900/70 px-3 py-1 text-[11px] text-slate-200 hover:border-emerald-400",children:"Copier t\xe9l\xe9phone"})]})]}),(0,s.jsx)("div",{className:"mt-auto text-[11px] text-slate-500",children:"UI SSR-safe : aucune lecture window/localStorage hors hooks."})]}):(0,s.jsx)("div",{className:"rounded-xl bg-slate-900/60 p-4 text-sm text-slate-400",children:"S\xe9lectionne un client \xe0 gauche pour voir les d\xe9tails."})})]})]})}function x(e){let{label:t,value:l,accent:r}=e;return(0,s.jsxs)("div",{className:"rounded-xl border px-3 py-2 ".concat("emerald"===r?"border-emerald-500/60 bg-gradient-to-br from-emerald-500/15 to-slate-950":"border-slate-800 bg-slate-950/60"),children:[(0,s.jsx)("div",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:t}),(0,s.jsx)("div",{className:"mt-1 text-sm text-slate-100",children:l})]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=1284)),_N_E=e.O()}]);