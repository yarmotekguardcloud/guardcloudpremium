(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8525],{8195:(e,t,s)=>{Promise.resolve().then(s.bind(s,9917))},9917:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var l=s(5155),r=s(2115),a=s(2619),n=s.n(a);function d(){var e;let[t,s]=(0,r.useState)("R-0001"),[a,d]=(0,r.useState)(5),[c,i]=(0,r.useState)(90),[x,u]=(0,r.useState)("Pack standard SahelGuard"),[p,m]=(0,r.useState)(!1),[b,h]=(0,r.useState)(null),[v,f]=(0,r.useState)([]),[g,j]=(0,r.useState)("R-0001"),[N,y]=(0,r.useState)(!1),[k,E]=(0,r.useState)(null),[w,C]=(0,r.useState)([]),[S,D]=(0,r.useState)(null),T=(0,r.useMemo)(()=>{let e=w.length,t=w.filter(e=>"NEW"===e.status).length,s=w.filter(e=>"ACTIVATED"===e.status).length;return{total:e,disponibles:t,activees:s,expirees:w.filter(e=>"EXPIRED"===e.status).length,revoquees:w.filter(e=>"REVOKED"===e.status).length}},[w]),R=async()=>{var e,s,l;try{let l;m(!0),h(null),f([]),D(null);let r={resellerId:t.trim(),count:a,durationDays:c,notes:x.trim()},n=await fetch("/api/admin/tokens/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),d=await n.text();try{l=JSON.parse(d)}catch(e){throw Error("R\xe9ponse non JSON (".concat(n.status,") : ").concat(d.slice(0,100),"…"))}if(!n.ok||!(null==l?void 0:l.ok)){let t=null!=(e=null==l?void 0:l.error)?e:"Erreur HTTP ".concat(n.status);throw Error(t)}f(null!=(s=l.tokens)?s:[])}catch(e){console.error("Erreur cr\xe9ation pack tokens:",e),h(null!=(l=null==e?void 0:e.message)?l:"Erreur inconnue")}finally{m(!1)}},I=async()=>{var e,t,s;try{let s;y(!0),E(null),C([]),D(null);let l=g.trim();if(!l)throw Error("Veuillez indiquer un ID revendeur.");let r=await fetch("/api/admin/tokens/by-reseller?resellerId=".concat(encodeURIComponent(l)),{method:"GET"}),a=await r.text();try{s=JSON.parse(a)}catch(e){throw Error("R\xe9ponse non JSON (".concat(r.status,") : ").concat(a.slice(0,100),"…"))}if(!r.ok||!(null==s?void 0:s.ok)){let t=null!=(e=null==s?void 0:s.error)?e:"Erreur HTTP ".concat(r.status);throw Error(t)}C(null!=(t=s.items)?t:[])}catch(e){console.error("Erreur chargement tokens revendeur:",e),E(null!=(s=null==e?void 0:e.message)?s:"Erreur inconnue")}finally{y(!1)}},_=async e=>{try{await navigator.clipboard.writeText(e),D("Token copi\xe9: ".concat(e)),setTimeout(()=>D(null),2500)}catch(e){D("Impossible de copier dans le presse-papier."),setTimeout(()=>D(null),2500)}},A=e=>{if(!e)return"—";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()};return(0,l.jsxs)("div",{className:"relative flex min-h-[calc(100vh-80px)] flex-col gap-4 bg-slate-950 px-4 pb-6 pt-4 text-slate-100",children:[(0,l.jsxs)("header",{className:"flex items-center justify-between gap-3 rounded-2xl border border-slate-800 bg-gradient-to-r from-slate-950 via-slate-900 to-slate-950 px-4 py-3 shadow-lg shadow-black/40",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"text-xl font-semibold tracking-tight",children:["Yarmotek GuardCloud •"," ",(0,l.jsx)("span",{className:"text-emerald-400",children:"Licences SahelGuard"})]}),(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"Cr\xe9e, distribue et contr\xf4le les tokens de licence fournis aux revendeurs et aux clients finaux."})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2 text-xs",children:[(0,l.jsx)(n(),{href:"/reseller/tokens",className:"rounded-full border border-slate-700 bg-slate-900 px-3 py-1 text-xs text-slate-200 hover:border-emerald-400",children:"Espace revendeur"}),(0,l.jsx)(n(),{href:"/client/activate",className:"rounded-full border border-emerald-500/60 bg-emerald-500/10 px-3 py-1 text-xs text-emerald-100 hover:bg-emerald-500/20",children:"Activer une licence"}),(0,l.jsx)(n(),{href:"/admin/devices",className:"rounded-full border border-sky-500/70 bg-sky-500/10 px-3 py-1 text-xs text-sky-100 hover:bg-sky-500/20",children:"Command Center (devices)"})]})]}),(0,l.jsxs)("section",{className:"flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-slate-800 bg-slate-950/90 px-4 py-3 shadow-[0_18px_40px_rgba(0,0,0,0.65)]",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-semibold",children:"Gestion des licences SahelGuard"}),(0,l.jsx)("p",{className:"text-xs text-slate-400",children:'Vue actuelle bas\xe9e sur les tokens du revendeur recherch\xe9 (champ "ID revendeur" ci-dessous).'})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[(0,l.jsx)(o,{label:"Total",value:T.total}),(0,l.jsx)(o,{label:"Disponibles",value:T.disponibles,variant:"green"}),(0,l.jsx)(o,{label:"Activ\xe9es",value:T.activees,variant:"blue"}),(0,l.jsx)(o,{label:"Expir\xe9es",value:T.expirees,variant:"amber"}),(0,l.jsx)(o,{label:"R\xe9voqu\xe9es",value:T.revoquees,variant:"red"}),(0,l.jsxs)("button",{type:"button",onClick:()=>void I(),disabled:N,className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-900 px-3 py-1 text-[11px] text-slate-200 hover:border-emerald-400 disabled:opacity-50",children:[(0,l.jsx)("span",{role:"img","aria-hidden":"true",children:"\uD83D\uDD04"}),N?"Rafra\xeechissement…":"Rafra\xeechir"]})]})]}),(0,l.jsxs)("main",{className:"grid flex-1 gap-6 md:grid-cols-2",children:[(0,l.jsxs)("section",{className:"flex flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-950/85 p-4 text-xs shadow-[0_18px_40px_rgba(0,0,0,0.65)]",children:[(0,l.jsx)("h2",{className:"text-sm font-semibold",children:"Cr\xe9er un pack de tokens pour un revendeur"}),(0,l.jsxs)("p",{className:"text-xs text-slate-400",children:["G\xe9n\xe8re un lot de licences SahelGuard pour un revendeur pr\xe9cis (ex :",(0,l.jsx)("span",{className:"font-mono",children:" R-0001"}),"). Les tokens sont stock\xe9s dans le Worker et visibles dans les espaces Admin et Revendeur."]}),(0,l.jsxs)("div",{className:"mt-1 grid grid-cols-2 gap-3 text-xs",children:[(0,l.jsxs)("div",{className:"col-span-2",children:[(0,l.jsx)("label",{className:"mb-1 block text-[11px] text-slate-400",children:"ID revendeur"}),(0,l.jsx)("input",{type:"text",value:t,onChange:e=>s(e.target.value),className:"w-full rounded-full border border-slate-700 bg-slate-900 px-3 py-1.5 text-xs text-slate-100 placeholder:text-slate-500 focus:border-emerald-400 focus:outline-none",placeholder:"Ex: R-0001"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-1 block text-[11px] text-slate-400",children:"Nombre de licences"}),(0,l.jsx)("input",{type:"number",min:1,max:500,value:a,onChange:e=>d(Math.max(1,Number(e.target.value)||1)),className:"w-full rounded-full border border-slate-700 bg-slate-900 px-3 py-1.5 text-xs text-slate-100 focus:border-emerald-400 focus:outline-none"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-1 block text-[11px] text-slate-400",children:"Dur\xe9e de validit\xe9 (jours)"}),(0,l.jsx)("input",{type:"number",min:7,max:3650,value:c,onChange:e=>i(Math.max(1,Number(e.target.value)||1)),className:"w-full rounded-full border border-slate-700 bg-slate-900 px-3 py-1.5 text-xs text-slate-100 focus:border-emerald-400 focus:outline-none"})]}),(0,l.jsxs)("div",{className:"col-span-2",children:[(0,l.jsx)("label",{className:"mb-1 block text-[11px] text-slate-400",children:"Label / notes internes"}),(0,l.jsx)("input",{type:"text",value:x,onChange:e=>u(e.target.value),className:"w-full rounded-full border border-slate-700 bg-slate-900 px-3 py-1.5 text-xs text-slate-100 placeholder:text-slate-500 focus:border-emerald-400 focus:outline-none",placeholder:"Ex: Pack Lancement D\xe9cembre 2025 – 45 licences / 90 jours"})]})]}),b&&(0,l.jsx)("div",{className:"rounded-xl bg-red-900/50 p-2 text-xs text-red-100",children:b}),(0,l.jsx)("button",{type:"button",disabled:p,onClick:()=>void R(),className:"mt-1 inline-flex items-center justify-center rounded-full border border-emerald-500/70 bg-emerald-600/20 px-4 py-2 text-xs font-semibold text-emerald-100 shadow-md shadow-emerald-900/40 hover:bg-emerald-600/30 disabled:opacity-50",children:p?"Cr\xe9ation en cours…":"Cr\xe9er le pack de tokens"}),v.length>0&&(0,l.jsxs)("div",{className:"mt-3 rounded-xl border border-emerald-500/60 bg-slate-900/80 p-3 text-xs",children:[(0,l.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-[11px] uppercase tracking-wide text-emerald-300",children:"Pack cr\xe9\xe9 avec succ\xe8s"}),(0,l.jsxs)("div",{className:"text-[11px] text-slate-300",children:[v.length," token(s) g\xe9n\xe9r\xe9(s) pour le revendeur"," ",(0,l.jsx)("span",{className:"font-semibold",children:null==(e=v[0])?void 0:e.resellerId}),"."]})]}),(0,l.jsx)("button",{type:"button",onClick:()=>void _(v.map(e=>e.token).join("\n")),className:"rounded-full border border-emerald-500/60 bg-emerald-500/10 px-3 py-1 text-[11px] text-emerald-100 hover:bg-emerald-500/20",children:"Copier tous les tokens"})]}),(0,l.jsx)("ul",{className:"space-y-1",children:v.map(e=>(0,l.jsxs)("li",{className:"flex items-center justify-between rounded-lg bg-slate-950/90 px-3 py-1.5",children:[(0,l.jsx)("span",{className:"font-mono text-[11px] text-slate-100",children:e.token}),(0,l.jsx)("button",{type:"button",onClick:()=>void _(e.token),className:"rounded-full border border-slate-700 bg-slate-900 px-2 py-0.5 text-[10px] text-slate-200 hover:border-emerald-400",children:"Copier"})]},e.token))})]})]}),(0,l.jsxs)("section",{className:"flex flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-950/85 p-4 text-xs shadow-[0_18px_40px_rgba(0,0,0,0.65)]",children:[(0,l.jsx)("h2",{className:"text-sm font-semibold",children:"Consulter les tokens d'un revendeur"}),(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"Saisis l'ID du revendeur pour visualiser tous ses tokens, leur statut, la date de cr\xe9ation, la date d'expiration et les clients / devices associ\xe9s."}),(0,l.jsxs)("div",{className:"mt-1 flex items-center gap-2 text-xs",children:[(0,l.jsx)("input",{type:"text",value:g,onChange:e=>j(e.target.value),className:"flex-1 rounded-full border border-slate-700 bg-slate-900 px-3 py-1.5 text-xs text-slate-100 placeholder:text-slate-500 focus:border-emerald-400 focus:outline-none",placeholder:"Ex: R-0001"}),(0,l.jsx)("button",{type:"button",disabled:N,onClick:()=>void I(),className:"rounded-full border border-emerald-500/60 bg-emerald-500/15 px-3 py-1.5 text-[11px] font-semibold text-emerald-100 hover:bg-emerald-500/25 disabled:opacity-50",children:N?"Chargement…":"Charger les tokens"})]}),k&&(0,l.jsx)("div",{className:"mt-1 rounded-xl bg-red-900/50 p-2 text-xs text-red-100",children:k}),(0,l.jsxs)("div",{className:"mt-2 max-h-[360px] overflow-auto rounded-xl border border-slate-800 bg-slate-950/90 text-[11px]",children:[0===w.length&&!N&&(0,l.jsxs)("div",{className:"p-4 text-center text-[11px] text-slate-400",children:["Aucun token \xe0 afficher pour cet ID revendeur.",(0,l.jsx)("br",{}),"V\xe9rifie l'identifiant ou cr\xe9e un pack de tokens."]}),w.length>0&&(0,l.jsxs)("table",{className:"min-w-full border-collapse text-left",children:[(0,l.jsx)("thead",{className:"sticky top-0 bg-slate-950/95",children:(0,l.jsxs)("tr",{className:"border-b border-slate-800 text-[10px] uppercase tracking-wide text-slate-400",children:[(0,l.jsx)("th",{className:"px-3 py-2",children:"Token"}),(0,l.jsx)("th",{className:"px-3 py-2",children:"Statut"}),(0,l.jsx)("th",{className:"px-3 py-2",children:"Client"}),(0,l.jsx)("th",{className:"px-3 py-2",children:"Device"}),(0,l.jsx)("th",{className:"px-3 py-2",children:"Validit\xe9"}),(0,l.jsx)("th",{className:"px-3 py-2"})]})}),(0,l.jsx)("tbody",{children:w.map(e=>(0,l.jsxs)("tr",{className:"border-b border-slate-900/70 hover:bg-slate-900/70",children:[(0,l.jsx)("td",{className:"px-3 py-2 align-top font-mono text-[10px] text-slate-100",children:e.token}),(0,l.jsx)("td",{className:"px-3 py-2 align-top",children:(0,l.jsx)("span",{className:"inline-flex rounded-full px-2 py-0.5 text-[10px] ".concat((e=>{switch(e){case"NEW":default:return"bg-slate-800 text-slate-100";case"ACTIVATED":return"bg-emerald-600/20 text-emerald-100";case"EXPIRED":return"bg-slate-800/80 text-slate-300";case"REVOKED":return"bg-rose-700/30 text-rose-100"}})(e.status)),children:(e=>{switch(e){case"NEW":return"Non utilis\xe9";case"ACTIVATED":return"Activ\xe9";case"EXPIRED":return"Expir\xe9";case"REVOKED":return"R\xe9voqu\xe9";default:return e}})(e.status)})}),(0,l.jsx)("td",{className:"px-3 py-2 align-top text-[10px] text-slate-200",children:e.clientId||"—"}),(0,l.jsx)("td",{className:"px-3 py-2 align-top text-[10px] text-slate-200",children:e.deviceId||"—"}),(0,l.jsxs)("td",{className:"px-3 py-2 align-top text-[10px] text-slate-300",children:[(0,l.jsxs)("div",{children:["Cr\xe9\xe9 : ",A(e.createdAt)]}),e.expiresAt&&(0,l.jsxs)("div",{children:["Expire : ",A(e.expiresAt)]})]}),(0,l.jsx)("td",{className:"px-3 py-2 align-top",children:(0,l.jsx)("button",{type:"button",onClick:()=>void _(e.token),className:"rounded-full border border-slate-700 bg-slate-900 px-2 py-0.5 text-[10px] text-slate-200 hover:border-emerald-400",children:"Copier"})})]},e.token))})]})]}),S&&(0,l.jsx)("div",{className:"mt-1 rounded-xl bg-slate-900/80 px-3 py-1.5 text-[11px] text-slate-100",children:S})]})]})]})}function o(e){let{label:t,value:s,variant:r}=e,a="border-slate-700 bg-slate-900 text-slate-100";return"green"===r?a="border-emerald-500/60 bg-emerald-500/10 text-emerald-100":"blue"===r?a="border-sky-500/60 bg-sky-500/10 text-sky-100":"amber"===r?a="border-amber-500/70 bg-amber-500/10 text-amber-100":"red"===r&&(a="border-rose-500/70 bg-rose-500/10 text-rose-100"),(0,l.jsxs)("div",{className:"rounded-full border px-3 py-1 text-[11px] ".concat(a),children:[(0,l.jsx)("span",{className:"mr-1 font-medium",children:t}),(0,l.jsx)("span",{className:"font-semibold",children:s})]})}}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=8195)),_N_E=e.O()}]);